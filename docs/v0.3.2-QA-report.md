# v0.3.2 QA Testing Report

**Status:** Ready for Testing

**Version:** v0.3.2 - Context & Intent

**Tested Features:**
- Intent-Driven Review (Pre-review form)
- Context Pruning (Dynamic file summarization)

---

## 1. Intent-Driven Review

### Pre-Review Form (`huh`)

- [ ] Form displays before review starts (interactive mode only)
- [ ] Form skipped in non-interactive mode (`--no-interactive`)
- [ ] Custom Instruction field accepts up to 500 characters
- [ ] Custom Instruction field is optional (can be empty)
- [ ] Focus Areas multi-select works (space to toggle, enter to confirm)
- [ ] Focus Areas options: Security, Performance, Logic, Style, Typo, Naming
- [ ] Multiple focus areas can be selected
- [ ] Negative Constraints field accepts up to 200 characters
- [ ] Negative Constraints field is optional
- [ ] Negative Constraints split by comma or newline correctly
- [ ] Form validation works (shows errors if any)
- [ ] Form can be cancelled (Ctrl+C)

### Smart Context Integration

- [ ] Selecting "Security" focus area injects `security` preset rules
- [ ] Selecting "Performance" focus area injects `performance` preset rules
- [ ] Selecting "Logic" focus area injects `logic` preset rules
- [ ] Selecting "Style" focus area injects `style` preset rules
- [ ] Selecting "Typo" focus area injects `typo` preset rules
- [ ] Selecting "Naming" focus area injects `naming` preset rules
- [ ] Multiple focus areas combine correctly in system prompt
- [ ] Custom instruction appears in system prompt under "Custom Instructions" section
- [ ] Negative constraints appear in system prompt under "Negative Constraints" section
- [ ] System prompt format: base prompt + focus areas + custom instruction + negative constraints

### Intent Collection Flow

- [ ] `ui.CollectIntent()` called in `cmd/review.go` before building context
- [ ] Intent passed to `Builder.WithIntent()` correctly
- [ ] `BuildSystemPromptWithIntent()` merges intent into system prompt
- [ ] Intent stored in `ReviewContext.Intent` field
- [ ] Intent persists through review session

---

## 2. Context Pruning

### File List View

- [ ] Press `i` in reviewing mode enters file list view
- [ ] File list shows all files from `FileContents` map
- [ ] File list displays file path and size
- [ ] Pruned files show "✓" indicator next to path
- [ ] Vim navigation works (`j/k` to navigate)
- [ ] File list title: "Files to Review"
- [ ] Empty file list handled gracefully
- [ ] Can exit file list view (Esc or `q`)

### Pruning Action

- [ ] Press `i` on selected file triggers pruning
- [ ] Pruning uses Gemini Flash model (`gemini-2.5-flash`)
- [ ] Pruning API call is non-blocking (uses `tea.Cmd`)
- [ ] Loading indicator shown during pruning
- [ ] Summary generated successfully
- [ ] Summary stored in `PrunedFiles` map
- [ ] File marked as pruned (✓ indicator appears)
- [ ] Pruned file summary replaces full content in subsequent prompts
- [ ] Can prune multiple files
- [ ] Can prune already-pruned file (replaces summary)


### Pruning Integration

- [ ] `PrunedFiles` map initialized in `ReviewContext` (non-nil)
- [ ] `BuildReviewPromptWithPruning()` uses summaries for pruned files
- [ ] Pruned files show as "File: `path` (Pruned)" in prompt
- [ ] Pruned files show summary instead of full content
- [ ] Non-pruned files show full content as before
- [ ] Pruning affects follow-up chat prompts (not just initial review)
- [ ] `startReview()` rebuilds prompt with pruned files if any exist

### Error Handling

- [ ] Pruning fails gracefully if API key not set
- [ ] Pruning fails gracefully if Gemini API error
- [ ] Error message displayed to user
- [ ] File not marked as pruned on error
- [ ] Can retry pruning after error
- [ ] Network timeout handled gracefully

---

## 3. Edge Cases & Error Handling

### Intent Form

- [ ] Very long custom instruction (500+ chars) truncated
- [ ] Special characters in custom instruction handled
- [ ] Empty focus areas selection works (no focus areas)
- [ ] All focus areas selected works
- [ ] Negative constraints with only commas/newlines handled
- [ ] Negative constraints with special characters handled
- [ ] Form submission with all fields empty works

### Context Pruning

- [ ] Pruning empty file handled
- [ ] Pruning very large file (>50KB) handled
- [ ] Pruning file with special characters in path handled
- [ ] Pruning file with binary content handled
- [ ] Pruning non-existent file handled
- [ ] Multiple rapid pruning requests handled
- [ ] Pruning during streaming review handled
- [ ] Pruning summary contains special characters handled

### System Prompt Building

- [ ] Intent with nil focus areas handled
- [ ] Intent with empty focus areas handled
- [ ] Focus area preset not found handled gracefully (skipped)
- [ ] System prompt with all intent fields empty works
- [ ] System prompt with only custom instruction works
- [ ] System prompt with only negative constraints works

---

## 4. Regression Testing

### Existing Features

- [ ] Review command works without intent form (non-interactive)
- [ ] Preset system works with intent (preset + intent combine)
- [ ] Chat mode works after pruning
- [ ] Yank commands work (`y`, `Y`)
- [ ] Vim navigation works in file list (`j/k`)
- [ ] Search works (`/`, `n/N`)
- [ ] Help overlay works (`?`)
- [ ] All existing keybindings work

### Integration

- [ ] Intent + preset replace mode works
- [ ] Intent + preset append mode works
- [ ] Pruning + intent works
- [ ] Pruning + preset works
- [ ] Multiple follow-up chats use pruned summaries

---

## 5. UI/UX Testing

### Visual

- [ ] Intent form displays correctly (huh theme)
- [ ] File list styling correct (purple title, proper spacing)
- [ ] Pruned indicator (✓) visible and clear
- [ ] File list navigation smooth
- [ ] No visual glitches when entering/exiting file list
- [ ] Loading indicator visible during pruning

### Performance

- [ ] Intent form loads quickly
- [ ] File list renders quickly for many files
- [ ] Pruning API call doesn't block UI
- [ ] Large file lists navigate smoothly
- [ ] Multiple pruned files don't slow down prompt building

### Accessibility

- [ ] All features accessible via keyboard
- [ ] Help overlay shows file list keybindings
- [ ] Error messages clear and actionable
- [ ] Success feedback visible after pruning

---

## 6. Known Issues

### IS01: Cannot ask follow-up questions

- [ ] **Status:** Open
- [ ] **Description:** Cannot type in chat mode after initial review
- [ ] **Reproduction:** Complete review, try to type in chat mode
- [ ] **Expected:** Should be able to type and send follow-up questions
- [ ] **Actual:** Cannot type characters

### IS02: Cannot quit after streaming error

- [ ] **Status:** Open
- [ ] **Description:** `q` key doesn't work after streaming error (e.g., safety block)
- [ ] **Reproduction:** Trigger streaming error (safety block), try to quit with `q`
- [ ] **Expected:** Should be able to quit with `q`
- [ ] **Actual:** `q` key doesn't respond

---

## 7. Test Results Summary

**Overall Status:** Pending

**Notes:**
- Focus on Intent form flow and Pruning integration
- Verify IS01 and IS02 reproduction steps
- Test edge cases for API failures and large files

---

## New Issues

> **NOTES:** Issues found during v0.3.2 testing

- [ ] **IS03:** (Add new issues here)

