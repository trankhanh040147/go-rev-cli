# v0.4.0 QA Testing Report

**Status:** Ready for Testing  
**Version:** v0.4.0 - Responsive Control

**Tested Features:**
- Async Pruning with Enhanced Feedback
- Robust Cancellation (Ctrl+X)
- Guided Intent Input

---

## 1. Async Pruning with Enhanced Feedback

### Per-File Spinners

- [x] Press `i` in reviewing mode enters file list view
- [x] File list shows all files from review context
- [x] Press `i` on a file starts pruning with spinner indicator (‚è≥)
- [x] Spinner appears next to file being pruned
- [x] Spinner uses purple color (`#7C3AED`) matching theme
- [x] Spinner animates smoothly during pruning
- [x] Multiple files can be pruned simultaneously
- [x] Each file shows its own spinner independently
- [x] Spinner disappears when pruning completes
- [x] Pruned files show ‚úì indicator after completion

### Non-Blocking UI

- [x] File list navigation (`j/k`) works during pruning
- [x] Can navigate to other files while pruning is active
- [ ] Can exit file list (Esc/q) during pruning
  - BUG01: q --> exit the review, it should exit file list 
- [x] No UI freezing or blocking during long pruning operations

### Multiple Simultaneous Pruning

- [x] Spinners update independently (not synchronized)
- [x] All pruning operations can be cancelled with Ctrl+X

### Pruning State Management

- [ ] `pruningSpinners` map tracks spinner state per file
- [ ] `pruningFiles` map tracks which files are being pruned
- [ ] `pruningCancels` map tracks cancel functions per file
- [ ] State cleaned up after successful pruning
- [ ] State cleaned up after cancelled pruning
- [ ] State cleaned up after failed pruning
- [ ] File list updates correctly after pruning completes

---

## 2. Robust Cancellation (Ctrl+X)

### Cancellation in All States

- [x] `Ctrl+X` works during initial review loading (StateLoading)
- [ ] `Ctrl+X` works during review streaming (StateReviewing)
  - #BUG02: show errors and force user to quit after cancel follow-ups questions --> it should show cancel successful and allow use retype follow-ups. Check similar cases
```


  üí¨ Follow-up Chat


  ‚ùØ hello


    Error: failed to send message: doRequest: error sending request: Post
    "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro:generat
    context
    canceled



q: quit

```
- [ ] `Ctrl+X` works during chat streaming (StateChatting)
- [x] `Ctrl+X` works in file list view (StateFileList)
- [x] `Ctrl+X` works when no active operation (shows feedback)

### Cancellation Behavior

- [ ] Cancels main active operation (`activeCancel`)
- [ ] Cancels all active pruning operations (`pruningCancels`)
- [ ] Cleans up all cancel functions after cancellation
- [ ] Removes pruning indicators from file list on cancel
- [ ] Shows immediate UI feedback ("Request cancelled" / "Pruning cancelled")
- [ ] Partial response retained after cancellation (review/chat)
- [ ] Can continue using app after cancellation
- [ ] Can start new operations after cancellation

### State Transitions on Cancel

- [ ] Loading state ‚Üí Error state on cancel (with message)
- [ ] Streaming review ‚Üí Error state on cancel
- [ ] Streaming chat ‚Üí Stays in chatting, shows feedback
- [ ] File list pruning ‚Üí Stays in file list, shows feedback
- [ ] Error state allows quitting with `q`

### Context Propagation

- [ ] `context.WithCancel` used for all long-running operations
- [ ] Context cancellation checked before starting operations
- [ ] Context cancellation checked during operations
- [ ] Pruning operations respect context cancellation
- [ ] Streaming operations respect context cancellation
- [ ] API calls respect context cancellation

---

## 3. Guided Intent Input

### Form Validation

- [ ] Custom instruction field accepts up to 500 characters
- [ ] Custom instruction validation: minimum 10 chars if provided
- [ ] Empty custom instruction allowed (optional field)
- [ ] Validation error shown if instruction < 10 chars
- [ ] Negative constraints field accepts up to 200 characters
- [ ] Negative constraints field is optional
- [ ] Focus areas multi-select works (space to toggle, enter to confirm)
- [ ] All focus areas can be selected
- [ ] No focus areas selected works (empty selection)
- [ ] Web search toggle checkbox works (default: enabled)

### Form UX

- [ ] Form displays with Catppuccin theme
- [ ] Field descriptions show helpful examples
- [ ] Custom instruction description: "Focus on error handling", "Check for race conditions", etc.
- [ ] Negative constraints placeholder: "e.g., 'variable names', 'style issues'"
- [ ] Focus areas description explains selection behavior
- [ ] Web search description explains default behavior
- [ ] Help text visible (`WithShowHelp(true)`)
- [ ] Error messages visible (`WithShowErrors(true)`)
- [ ] Form can be cancelled with Ctrl+C

### Intent Integration

- [ ] Intent collected before review starts (interactive mode)
- [ ] Intent skipped in non-interactive mode (`--no-interactive`)
- [ ] Custom instruction appears in system prompt
- [ ] Focus areas inject corresponding preset rules
- [ ] Negative constraints appear in system prompt
- [ ] Web search setting passed to API calls
- [ ] Web search can be toggled in chat mode (if implemented)

### Negative Constraints Parsing

- [ ] Constraints split by comma correctly
- [ ] Constraints split by newline correctly
- [ ] Multiple constraints parsed correctly
- [ ] Empty constraints after trimming handled
- [ ] Whitespace trimmed from each constraint
- [ ] Empty constraint list works (no constraints)

---

## 4. Edge Cases & Error Handling

### Pruning Edge Cases

- [ ] Pruning empty file handled gracefully
- [ ] Pruning very large file (>50KB) handled
- [ ] Pruning file with special characters in path handled
- [ ] Pruning file with binary content handled
- [ ] Pruning non-existent file handled (should not happen, but verify)
- [ ] Multiple rapid pruning requests handled (prevents duplicate)
- [ ] Pruning already-pruned file handled (replaces summary)
- [ ] Pruning during streaming review handled
- [ ] Pruning summary contains special characters handled
- [ ] Pruning fails gracefully if flash client not initialized
- [ ] Pruning fails gracefully if API key not set
- [ ] Pruning fails gracefully if Gemini API error
- [ ] Pruning fails gracefully on network timeout
- [ ] Error message displayed to user on pruning failure
- [ ] File not marked as pruned on error
- [ ] Can retry pruning after error

### Cancellation Edge Cases

- [ ] Cancelling during multiple simultaneous prunings works
- [ ] Cancelling after operation completes (no-op, shows feedback)
- [ ] Rapid multiple cancellations handled
- [ ] Cancellation during context cancellation handled
- [ ] Cancellation cleanup doesn't cause race conditions
- [ ] State remains consistent after cancellation

### Intent Form Edge Cases

- [ ] Very long custom instruction (500+ chars) handled
- [ ] Special characters in custom instruction handled
- [ ] Empty focus areas selection works
- [ ] All focus areas selected works
- [ ] Negative constraints with only commas/newlines handled
- [ ] Negative constraints with special characters handled
- [ ] Form submission with all fields empty works
- [ ] Form cancellation (Ctrl+C) handled gracefully

### API Error Handling

- [ ] API key missing shows clear error
- [ ] Invalid API key shows clear error
- [ ] Network timeout handled gracefully
- [ ] Rate limit errors handled gracefully
- [ ] Safety block errors handled gracefully (FinishReasonSafety)
- [ ] Streaming errors handled gracefully
- [ ] Partial responses retained on error
- [ ] Error messages are clear and actionable
- [ ] Can retry after error

### Context Building Edge Cases

- [ ] No changes detected handled (shows message, exits gracefully)
- [ ] Empty diff handled
- [ ] Very large diff handled
- [ ] Secret detection blocks review (with `--force` override)
- [ ] Invalid base branch/commit handled
- [ ] Staged and base flags together show error (mutually exclusive)

---

## 5. Regression Testing

### Existing Features (v0.3.x)

- [ ] Review command works with all flags (`-s`, `-b`, `-m`, `-f`, `-i`, `-I`, `-k`, `-p`, `-R`)
- [ ] Vim navigation works (`j/k`, `g/G`, `Ctrl+d/u/f/b`)
- [ ] Search works (`/`, `n/N`, `Tab` toggle)
- [ ] Help overlay works (`?` key)
- [ ] Yank commands work (`y`, `Y`)
- [ ] Chat mode works (`Enter` to enter, `Alt+Enter` to send)
- [ ] Review presets work (`--preset` flag)
- [ ] Preset replace mode works (`--preset-replace` / `-R`)
- [ ] Context preview shows correctly
- [ ] Token usage display works
- [ ] Non-interactive mode works
- [ ] Secret detection works

### Preset Management (v0.3.0)

- [ ] `preset list` shows all presets
- [ ] `preset create` creates custom preset
- [ ] `preset edit` edits custom preset
- [ ] `preset delete` deletes custom preset
- [ ] `preset show` shows preset details
- [ ] `preset open` opens preset file/directory
- [ ] `preset path` shows preset path
- [ ] `preset default` sets/shows default preset
- [ ] `preset system` commands work (show/edit/reset)

### Intent & Pruning Integration (v0.3.2)

- [ ] Intent form displays before review (interactive mode)
- [ ] Intent skipped in non-interactive mode
- [ ] Focus areas inject preset rules correctly
- [ ] Custom instruction appears in system prompt
- [ ] Negative constraints appear in system prompt
- [ ] File list view works (`i` key)
- [ ] Pruning replaces file content with summary
- [ ] Pruned files show ‚úì indicator
- [ ] Pruning affects follow-up chat prompts

---

## 6. Integration Testing

### Intent + Pruning

- [ ] Intent form ‚Üí Review ‚Üí Prune files ‚Üí Chat works
- [ ] Pruned files used in follow-up chats correctly
- [ ] Intent settings persist through pruning operations

### Intent + Preset

- [ ] Intent + preset replace mode works
- [ ] Intent + preset append mode works
- [ ] Focus areas + preset combine correctly
- [ ] Custom instruction + preset combine correctly

### Pruning + Preset

- [ ] Pruning works with all presets
- [ ] Pruned summaries used correctly with presets

### Cancellation + All Features

- [ ] Cancel during review ‚Üí Can start new review
- [ ] Cancel during chat ‚Üí Can continue chatting
- [ ] Cancel during pruning ‚Üí Can prune again
- [ ] Cancel multiple operations ‚Üí State remains clean

---

## 7. UI/UX Testing

### Visual

- [ ] Pruning spinner visible and animated
- [ ] Spinner color matches theme (purple `#7C3AED`)
- [ ] Pruned indicator (‚úì) visible and clear
- [ ] File list styling correct
- [ ] Cancellation feedback visible ("Request cancelled", etc.)
- [ ] Intent form displays correctly (huh theme)
- [ ] No visual glitches during state transitions
- [ ] No layout breaks with long file paths
- [ ] Help overlay shows Ctrl+X keybinding

### Performance

- [ ] Intent form loads quickly
- [ ] File list renders quickly for many files
- [ ] Pruning API calls don't block UI
- [ ] Multiple simultaneous prunings don't slow UI
- [ ] Cancellation is immediate (no lag)
- [ ] Large file lists navigate smoothly
- [ ] Multiple pruned files don't slow prompt building

### Accessibility

- [ ] All features accessible via keyboard
- [ ] Help overlay shows all keybindings (including Ctrl+X)
- [ ] Error messages clear and actionable
- [ ] Success feedback visible after operations
- [ ] Form validation errors clear

---

## 8. Cross-Platform Testing

- [ ] Works on Linux
- [ ] Works on macOS (if applicable)
- [ ] Works on Windows (if applicable)
- [ ] Terminal compatibility verified
- [ ] Ctrl+X works on all platforms
- [ ] File paths handled correctly on all platforms

---

## 9. Test Results Summary

**Overall Status:** Pending

**Notes:**
- Focus on async pruning feedback and cancellation robustness
- Verify all edge cases for API failures and network issues
- Test integration between intent, pruning, and presets
- Verify regression of existing features

---

## Known Issues from Previous Versions

### Fixed in v0.4.0

- [x] **IS01:** Cannot ask follow-up questions ‚Üí Fixed
- [x] **IS02:** Cannot quit (`q`) after streaming error ‚Üí Fixed
- [x] **IS03:** Need to detect/bypass `FinishReasonSafety` ‚Üí Fixed
- [x] **IS04:** Cannot cancel streaming ‚Üí Fixed (Ctrl+X implemented)

---

## New Issues Found

> **NOTES:** Issues found during v0.4.0 testing

- [ ] **IS05:** (Add new issues here)

